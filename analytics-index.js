!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AnalyticsWrapper=t()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(t,r)};function t(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function o(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))}function i(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function a(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function u(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}for(var c=[],d=0;d<256;++d)c[d]=(d+256).toString(16).substr(1);var l=function(e,t){var r=t||0,n=c;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")},h=u((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}}));var f,p=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||h)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[n+i]=o[i];return t||l(o)};!function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warn=2]="Warn",e[e.Error=3]="Error"}(f||(f={}));var v=null,g=!1;function y(e,t,r){if((g||r)&&window&&window.console){var n="Analytics Wrapper -> "+t;switch(e){case f.Info:console.info(n);break;case f.Warn:console.warn(n);break;case f.Error:console.error(n);break;default:console.debug(n)}}}var m=function(){function e(e){g=e}return e.prototype.debug=function(e){y(f.Debug,e)},e.prototype.info=function(e){y(f.Info,e)},e.prototype.warn=function(e){y(f.Warn,e)},e.prototype.error=function(e,t){y(f.Error,e,t)},e.getLogger=function(t){return null!=t&&(g=t),v||(v=new e(t))},e}(),E=(new function(){var e=this;this.getGlobal=function(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:(e.logger.error("Couldn't define polyfill version for globalThis. Returning null."),null)},this.logger=new m(!1)}).getGlobal(),_=function(e,t,r,n,o){var i=this;void 0===n&&(n="/"),this.name=e,this.value=t,this.expires=r,this.path=n,this.domain=o,this.getUniqueCookieValue=function(){return i.cookie.value=p(),i.cookie.value},this.getCookieDomain=function(){var e=E.window.location.hostname.split("."),t=(e[0],e.slice(1).join("."));if(t.length)return"."+t},this.updateCookieExpiration=function(e){try{var t=new Date(Date.now()+e).toUTCString(),r=i.getCookie(""+i.cookie.name),n=i.cookie.domain||i.getCookieDomain(),o="domain="+n+";";return globalThis.document.cookie=i.cookie.name+"="+encodeURIComponent(r)+"; expires="+t+"; path="+i.cookie.path+"; "+(n?o:""),i.cookie.expires=t,!0}catch(e){return i.logger.warn(e,"graceful degradation of setCookie, error setting session_id flag, gracefully degrading to undefined"),!1}},this.setToStorage=function(e,t){try{return E.localStorage.setItem(e,t)}catch(t){return i.logger.warn(t,"graceful degradation of setStorage(localStorage), error setting "+e+" flag, gracefully degrading to false"),!1}},this.getFromStorage=function(e){try{return E.localStorage.getItem(e)}catch(t){return void i.logger.warn(t,"graceful degradation of getStorage(localStorage), error getting "+e+" flag, gracefully degrading to undefined")}},this.getCookie=function(e){try{return void 0!==i.cookie.value?i.cookie.value:E.document.cookie.split("; ").reduce((function(t,r){var n=r.split("=");return n[0]===e?decodeURIComponent(n[1]):t}),"")}catch(t){return void i.logger.warn(t,"graceful degradation of getCookie, error getting "+e+" flag, gracefully degrading to undefined")}},this.setCookie=function(e,t,r){try{var n=encodeURIComponent(t),o=new Date(Date.now()+r).toUTCString(),a=i.getCookieDomain(),s="domain="+a+";";return E.document.cookie=e+"="+n+"; expires="+o+"; "+(a?s:""),i.cookie={name:e,value:t,domain:a},!0}catch(t){return i.logger.warn(t,"graceful degradation of setCookie, error setting "+e+" flag, gracefully degrading to undefined"),!1}},this.logger=m.getLogger(),this.cookie={name:e,value:t,expires:r,path:n,domain:o}},b=function(e){function r(){var t=e.call(this,r.sstkCookieName)||this;return t.getAnonFromCookie=function(){var e=!1,n=t.getCookie(r.sstkCookieName);n||(e=!0,(n=t.getFromStorage(r.sstkCookieName))||(n=t.getCookie(r.ajsCookieName)||t.getUniqueCookieValue()));return'"'===n.charAt(0)&&(n=n.slice(1,-1)),e&&(t.setCookie(r.sstkCookieName,n,r.Expiration),t.setToStorage(r.sstkCookieName,n)),n},t.anonId=t.getAnonFromCookie(),t}return t(r,e),Object.defineProperty(r.prototype,"anonID",{get:function(){return this.anonId},enumerable:!1,configurable:!0}),r.sstkCookieName="sstk_anonymous_id",r.ajsCookieName="ajs_anonymous_id",r.Expiration=31536e7,r}(_);var D=function(){this.__data__=[],this.size=0};var O=function(e,t){return e===t||e!=e&&t!=t};var C=function(e,t){for(var r=e.length;r--;)if(O(e[r][0],t))return r;return-1},T=Array.prototype.splice;var S=function(e){var t=this.__data__,r=C(t,e);return!(r<0)&&(r==t.length-1?t.pop():T.call(t,r,1),--this.size,!0)};var A=function(e){var t=this.__data__,r=C(t,e);return r<0?void 0:t[r][1]};var I=function(e){return C(this.__data__,e)>-1};var k=function(e,t){var r=this.__data__,n=C(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function w(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}w.prototype.clear=D,w.prototype.delete=S,w.prototype.get=A,w.prototype.has=I,w.prototype.set=k;var R=w;var N=function(){this.__data__=new R,this.size=0};var P=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var U=function(e){return this.__data__.get(e)};var j=function(e){return this.__data__.has(e)};function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var V="object"==L(s)&&s&&s.Object===Object&&s,Q="object"==("undefined"==typeof self?"undefined":L(self))&&self&&self.Object===Object&&self,q=V||Q||Function("return this")(),x=q.Symbol,M=Object.prototype,W=M.hasOwnProperty,H=M.toString,F=x?x.toStringTag:void 0;var G=function(e){var t=W.call(e,F),r=e[F];try{e[F]=void 0;var n=!0}catch(e){}var o=H.call(e);return n&&(t?e[F]=r:delete e[F]),o},B=Object.prototype.toString;var z=function(e){return B.call(e)},K=x?x.toStringTag:void 0;var J=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":K&&K in Object(e)?G(e):z(e)};var $=function(e){var t=L(e);return null!=e&&("object"==t||"function"==t)};var Y,X=function(e){if(!$(e))return!1;var t=J(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Z=q["__core-js_shared__"],ee=(Y=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+Y:"";var te=function(e){return!!ee&&ee in e},re=Function.prototype.toString;var ne=function(e){if(null!=e){try{return re.call(e)}catch(e){}try{return e+""}catch(e){}}return""},oe=/^\[object .+?Constructor\]$/,ie=Function.prototype,ae=Object.prototype,se=ie.toString,ue=ae.hasOwnProperty,ce=RegExp("^"+se.call(ue).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var de=function(e){return!(!$(e)||te(e))&&(X(e)?ce:oe).test(ne(e))};var le=function(e,t){return null==e?void 0:e[t]};var he=function(e,t){var r=le(e,t);return de(r)?r:void 0},fe=he(q,"Map"),pe=he(Object,"create");var ve=function(){this.__data__=pe?pe(null):{},this.size=0};var ge=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ye=Object.prototype.hasOwnProperty;var me=function(e){var t=this.__data__;if(pe){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return ye.call(t,e)?t[e]:void 0},Ee=Object.prototype.hasOwnProperty;var _e=function(e){var t=this.__data__;return pe?void 0!==t[e]:Ee.call(t,e)};var be=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=pe&&void 0===t?"__lodash_hash_undefined__":t,this};function De(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}De.prototype.clear=ve,De.prototype.delete=ge,De.prototype.get=me,De.prototype.has=_e,De.prototype.set=be;var Oe=De;var Ce=function(){this.size=0,this.__data__={hash:new Oe,map:new(fe||R),string:new Oe}};var Te=function(e){var t=L(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Se=function(e,t){var r=e.__data__;return Te(t)?r["string"==typeof t?"string":"hash"]:r.map};var Ae=function(e){var t=Se(this,e).delete(e);return this.size-=t?1:0,t};var Ie=function(e){return Se(this,e).get(e)};var ke=function(e){return Se(this,e).has(e)};var we=function(e,t){var r=Se(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Re(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Re.prototype.clear=Ce,Re.prototype.delete=Ae,Re.prototype.get=Ie,Re.prototype.has=ke,Re.prototype.set=we;var Ne=Re;var Pe=function(e,t){var r=this.__data__;if(r instanceof R){var n=r.__data__;if(!fe||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ne(n)}return r.set(e,t),this.size=r.size,this};function Ue(e){var t=this.__data__=new R(e);this.size=t.size}Ue.prototype.clear=N,Ue.prototype.delete=P,Ue.prototype.get=U,Ue.prototype.has=j,Ue.prototype.set=Pe;var je=Ue,Le=function(){try{var e=he(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var Ve=function(e,t,r){"__proto__"==t&&Le?Le(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r};var Qe=function(e,t,r){(void 0!==r&&!O(e[t],r)||void 0===r&&!(t in e))&&Ve(e,t,r)};var qe=function(e){return function(t,r,n){for(var o=-1,i=Object(t),a=n(t),s=a.length;s--;){var u=a[e?s:++o];if(!1===r(i[u],u,i))break}return t}}(),xe=u((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?q.Buffer:void 0,i=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=i?i(r):new e.constructor(r);return e.copy(n),n}})),Me=q.Uint8Array;var We=function(e){var t=new e.constructor(e.byteLength);return new Me(t).set(new Me(e)),t};var He=function(e,t){var r=t?We(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Fe=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t},Ge=Object.create,Be=function(){function e(){}return function(t){if(!$(t))return{};if(Ge)return Ge(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();var ze=function(e,t){return function(r){return e(t(r))}}(Object.getPrototypeOf,Object),Ke=Object.prototype;var Je=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Ke)};var $e=function(e){return"function"!=typeof e.constructor||Je(e)?{}:Be(ze(e))};var Ye=function(e){return null!=e&&"object"==L(e)};var Xe=function(e){return Ye(e)&&"[object Arguments]"==J(e)},Ze=Object.prototype,et=Ze.hasOwnProperty,tt=Ze.propertyIsEnumerable,rt=Xe(function(){return arguments}())?Xe:function(e){return Ye(e)&&et.call(e,"callee")&&!tt.call(e,"callee")},nt=Array.isArray;var ot=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var it=function(e){return null!=e&&ot(e.length)&&!X(e)};var at=function(e){return Ye(e)&&it(e)};var st=function(){return!1},ut=u((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?q.Buffer:void 0,i=(o?o.isBuffer:void 0)||st;e.exports=i})),ct=Function.prototype,dt=Object.prototype,lt=ct.toString,ht=dt.hasOwnProperty,ft=lt.call(Object);var pt=function(e){if(!Ye(e)||"[object Object]"!=J(e))return!1;var t=ze(e);if(null===t)return!0;var r=ht.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&lt.call(r)==ft},vt={};vt["[object Float32Array]"]=vt["[object Float64Array]"]=vt["[object Int8Array]"]=vt["[object Int16Array]"]=vt["[object Int32Array]"]=vt["[object Uint8Array]"]=vt["[object Uint8ClampedArray]"]=vt["[object Uint16Array]"]=vt["[object Uint32Array]"]=!0,vt["[object Arguments]"]=vt["[object Array]"]=vt["[object ArrayBuffer]"]=vt["[object Boolean]"]=vt["[object DataView]"]=vt["[object Date]"]=vt["[object Error]"]=vt["[object Function]"]=vt["[object Map]"]=vt["[object Number]"]=vt["[object Object]"]=vt["[object RegExp]"]=vt["[object Set]"]=vt["[object String]"]=vt["[object WeakMap]"]=!1;var gt=function(e){return Ye(e)&&ot(e.length)&&!!vt[J(e)]};var yt=function(e){return function(t){return e(t)}},mt=u((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&V.process,i=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=i})),Et=mt&&mt.isTypedArray,_t=Et?yt(Et):gt;var bt=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},Dt=Object.prototype.hasOwnProperty;var Ot=function(e,t,r){var n=e[t];Dt.call(e,t)&&O(n,r)&&(void 0!==r||t in e)||Ve(e,t,r)};var Ct=function(e,t,r,n){var o=!r;r||(r={});for(var i=-1,a=t.length;++i<a;){var s=t[i],u=n?n(r[s],e[s],s,r,e):void 0;void 0===u&&(u=e[s]),o?Ve(r,s,u):Ot(r,s,u)}return r};var Tt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},St=/^(?:0|[1-9]\d*)$/;var At=function(e,t){var r=L(e);return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&St.test(e))&&e>-1&&e%1==0&&e<t},It=Object.prototype.hasOwnProperty;var kt=function(e,t){var r=nt(e),n=!r&&rt(e),o=!r&&!n&&ut(e),i=!r&&!n&&!o&&_t(e),a=r||n||o||i,s=a?Tt(e.length,String):[],u=s.length;for(var c in e)!t&&!It.call(e,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||At(c,u))||s.push(c);return s};var wt=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Rt=Object.prototype.hasOwnProperty;var Nt=function(e){if(!$(e))return wt(e);var t=Je(e),r=[];for(var n in e)("constructor"!=n||!t&&Rt.call(e,n))&&r.push(n);return r};var Pt=function(e){return it(e)?kt(e,!0):Nt(e)};var Ut=function(e){return Ct(e,Pt(e))};var jt=function(e,t,r,n,o,i,a){var s=bt(e,r),u=bt(t,r),c=a.get(u);if(c)Qe(e,r,c);else{var d=i?i(s,u,r+"",e,t,a):void 0,l=void 0===d;if(l){var h=nt(u),f=!h&&ut(u),p=!h&&!f&&_t(u);d=u,h||f||p?nt(s)?d=s:at(s)?d=Fe(s):f?(l=!1,d=xe(u,!0)):p?(l=!1,d=He(u,!0)):d=[]:pt(u)||rt(u)?(d=s,rt(s)?d=Ut(s):$(s)&&!X(s)||(d=$e(u))):l=!1}l&&(a.set(u,d),o(d,u,n,i,a),a.delete(u)),Qe(e,r,d)}};var Lt=function e(t,r,n,o,i){t!==r&&qe(r,(function(a,s){if(i||(i=new je),$(a))jt(t,r,s,n,e,o,i);else{var u=o?o(bt(t,s),a,s+"",t,r,i):void 0;void 0===u&&(u=a),Qe(t,s,u)}}),Pt)};var Vt=function(e){return e};var Qt=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},qt=Math.max;var xt=function(e,t,r){return t=qt(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,i=qt(n.length-t,0),a=Array(i);++o<i;)a[o]=n[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=n[o];return s[t]=r(a),Qt(e,this,s)}};var Mt=function(e){return function(){return e}},Wt=Le?function(e,t){return Le(e,"toString",{configurable:!0,enumerable:!1,value:Mt(t),writable:!0})}:Vt,Ht=Date.now;var Ft=function(e){var t=0,r=0;return function(){var n=Ht(),o=16-(n-r);if(r=n,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Wt);var Gt=function(e,t){return Ft(xt(e,t,Vt),e+"")};var Bt=function(e,t,r){if(!$(r))return!1;var n=L(t);return!!("number"==n?it(r)&&At(t,r.length):"string"==n&&t in r)&&O(r[t],e)};var zt=function(e){return Gt((function(t,r){var n=-1,o=r.length,i=o>1?r[o-1]:void 0,a=o>2?r[2]:void 0;for(i=e.length>3&&"function"==typeof i?(o--,i):void 0,a&&Bt(r[0],r[1],a)&&(i=o<3?void 0:i,o=1),t=Object(t);++n<o;){var s=r[n];s&&e(t,s,n,i)}return t}))}((function(e,t,r){Lt(e,t,r)})),Kt=["gclid","kw","gclsrc","msclkid","fbclid","yclid","image_type","irgwc","irclickid","int_source","int_medium","int_campaign","int_content","utm_medium","utm_source","utm_campaign","utm_term"],Jt=["email","visitor_id"],$t=function(e,t){return Object.assign.apply(Object,a([{}],t.map((function(t){var r;return(r={})[t]=e[t],r}))))},Yt=function(e){return zt({},e)},Xt=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object.assign.apply(Object,a([{}],e.reverse()))},Zt=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return zt.apply(void 0,a([e],t.reverse(),[Yt(e)]))},er=function(e){return"string"==typeof e||null!=e&&e.constructor===String},tr=function(e){return(t=[e.eventAction,e.pageSection,e.eventLabel],t.filter((function(e){return e}))).join(".");var t},rr=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];er(t)||(r.unshift(t),t=void 0);var o=e.overlay.apply(e,a(r,[{eventCategory:"userInteraction"}]));return o.uiEventName=t||tr(o),[t||o.eventAction,o]},nr=function(e){try{var t=new URL(e).search.substring(1),r=new URLSearchParams(t),n={},o={};r.forEach((function(e,t){(Kt||[]).includes(t)&&(n[t]=e),["pl","cr"].includes(t)&&!o[t]&&(o[t]=e)}));var i={};if(Object.keys(n).length&&(i.parameters=n),Object.keys(o).length){var a=o.pl,s=o.cr,u=a.split("-",2);i.basket=u[0],i.carton=u[1],i.egg=s}return Object.keys(i).length?{visit:i}:{}}catch(e){return null}},or=function(e){var t=e.message,n=e.name,o=e.stack;return r({message:t,name:n,stack:o},e)},ir={page:{}},ar=function(){function e(e){this.data=e,this.data=Yt(Zt(e,ir))}return e.prototype.update=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zt.apply(void 0,a([this.data],e)),this.toJSON()},e.prototype.overlay=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r={eventAction:null,eventLabel:null,eventCategory:null};return zt.apply(void 0,a([r,this.data],e))},e.prototype.toJSON=function(){return Yt(this.data)},e}(),sr={click:"click",submit:"submit",change:"change",hover:"mouseenter"};Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),r=t.length,n=new Array(r);r;)n[r-=1]=[t[r],e[t[r]]];return n});var ur=function(e,t){return function(r){return Object.entries(e).map((function(e){var n=e[0];return{action:n,domEvent:e[1],handler:r(n),delegate:t}}))}},cr=ur($t(sr,["hover"]),!1),dr=ur($t(sr,["change","click","submit"]),!0),lr=function(e){return{direct:cr(e),delegated:dr(e)}},hr="[data-track]";function fr(e){if(e.dataset&&void 0!==e.dataset.track){var t=e.dataset.track.trim().split("."),r=t[0],n=t[1],o=t[2],i=t.slice(3);delete e.dataset.track,e.dataset.trackAction=r.replace(/\s*,\s*/," ").trim(),void 0!==n&&(e.dataset.trackSection=n.trim()),void 0!==o&&(e.dataset.trackLabel=o.trim()),i.length&&(e.dataset.trackValue=i.join(".").trim())}}function pr(e){var t,r;(t=[e]).concat.apply(t,e.querySelectorAll(hr)).forEach(fr),r=e,new E.MutationObserver((function(e){return e.reduce((function(e,t){return e.concat(Array.from(t.addedNodes))}),[]).filter((function(e){return e.nodeType===E.Node.ELEMENT_NODE})).reduce((function(e,t){return e.concat(t.matches(hr)?t:[],Array.from(t.querySelectorAll(hr)))}),[]).forEach(fr)})).observe(r,{childList:!0,subtree:!0})}var vr,gr=Tr,yr=0,mr=0,Er={},_r={};function br(e,t,r){return"_root"==t?r:e!==r?function(e){return vr||(vr=e.matches?e.matches:e.webkitMatchesSelector?e.webkitMatchesSelector:e.mozMatchesSelector?e.mozMatchesSelector:e.msMatchesSelector?e.msMatchesSelector:e.oMatchesSelector?e.oMatchesSelector:Tr.matchesSelector)}(e).call(e,t)?e:e.parentNode?(yr++,br(e.parentNode,t,r)):void 0:void 0}function Dr(e,t,r,n){Er[e.id]||(Er[e.id]={}),Er[e.id][t]||(Er[e.id][t]={}),Er[e.id][t][r]||(Er[e.id][t][r]=[]),Er[e.id][t][r].push(n)}function Or(e,t,r,n){if(Er[e.id])if(t)if(n||r)if(n){if(Er[e.id][t]&&Er[e.id][t][r]){for(var o=0;o<Er[e.id][t][r].length;o++)if(Er[e.id][t][r][o]===n){Er[e.id][t][r].splice(o,1),Er[e.id][t][r].match=void 0;break}var i=!1;for(var a in Er[e.id])for(var s in Er[e.id][a]){var u=Er[e.id][a][s];if(Array.isArray(u)&&u.length>0){i=!0;break}}i||delete _r[e.id]}}else delete Er[e.id][t][r];else Er[e.id][t]={};else for(var c in Er[e.id])Er[e.id].hasOwnProperty(c)&&(Er[e.id][c]={})}function Cr(e,t,r,n){if(this.element){e instanceof Array||(e=[e]),r||"function"!=typeof t||(r=t,t="_root");var o,i=this.id;for(o=0;o<e.length;o++)n?Or(this,e[o],t,r):(Er[i]&&Er[i][e[o]]||Tr.addEvent(this,e[o],a(e[o])),Dr(this,e[o],t,r));return this}function a(e){return function(t){!function(e,t,r){if(Er[e][r]){var n,o,i=t.target||t.srcElement,a={},s=0,u=0;for(n in yr=0,Er[e][r])Er[e][r].hasOwnProperty(n)&&(o=br(i,n,_r[e].element))&&Tr.matchesEvent(r,_r[e].element,o,"_root"==n,t)&&(yr++,Er[e][r][n].match=o,a[yr]=Er[e][r][n]);for(t.stopPropagation=function(){t.cancelBubble=!0},s=0;s<=yr;s++)if(a[s])for(u=0;u<a[s].length;u++){if(!1===a[s][u].call(a[s].match,t))return void Tr.cancel(t);if(t.cancelBubble)return}}}(i,t,e)}}}function Tr(e,t){if(!(this instanceof Tr)){for(var r in _r)if(_r[r].element===e)return _r[r];return mr++,_r[mr]=new Tr(e,mr),_r[mr]}this.element=e,this.id=t}Tr.prototype.on=function(e,t,r){return Cr.call(this,e,t,r)},Tr.prototype.off=function(e,t,r){return Cr.call(this,e,t,r,!0)},Tr.matchesSelector=function(){},Tr.cancel=function(e){e.preventDefault(),e.stopPropagation()},Tr.addEvent=function(e,t,r){var n="blur"==t||"focus"==t;e.element.addEventListener(t,r,n)},Tr.matchesEvent=function(){return!0};var Sr=function(e,t){return function(r){return gr(r).off(e,t).on(e,t)}},Ar=function(e){return function(t,r){return t.concat(r.matches(e)?r:[],Array.from(r.querySelectorAll(e)))}},Ir=function(e){return"[data-track-action~="+e+"]"},kr=function(e){return function(t){var r=t.action,n=t.domEvent,o=t.handler;return gr(e).off(n,Ir(r),o).on(n,Ir(r),o)}},wr=function(e,t,r){var n,o,i=r.filter((function(e){return e.nodeType===E.Node.ELEMENT_NODE})).reduce(Ar(Ir(t.action)),[]);t.delegate&&i.length>0?kr(e)(t):t.delegate||i.forEach((n=t.domEvent,o=t.handler,function(e){return gr(e).off(n,o)}))},Rr=function(e,t){return e.forEach((r=t,function(e){var t=e.action,n=e.domEvent,o=e.handler;return r.querySelectorAll(Ir(t)).forEach(Sr(n,o))}));var r},Nr=function(e){return function(t){return new E.MutationObserver((function(r){r.forEach((function(r){wr(e,t,Array.from(r.removedNodes)),function(e,t,r){t.delegate||r.filter((function(e){return e.nodeType===E.Node.ELEMENT_NODE})).reduce(Ar(Ir(t.action)),[]).forEach(Sr(t.domEvent,t.handler))}(0,t,Array.from(r.addedNodes))}))})).observe(e,{childList:!0,subtree:!0})}};void 0!==E&&E.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(e,t){t=t||void 0!==E&&E;for(var r=0;r<this.length;r+=1)e.call(t,this[r],r,this)});var Pr={checkbox:function(e){return Array.from(document.getElementsByName(e.name)).filter((function(e){return e.checked})).map((function(e){return e.value}))},"select-multiple":function(e){return Array.from(e.selectedOptions).map((function(e){return e.value}))},default:function(e){return e.value}},Ur={change:function(e){return function(t,r){var n;Object.assign(r.eventValue,{formElementValue:(n=t,(Pr[n.type]||Pr.default)(n))}),e(r)}},hover:function(e){return function(t,r){var n=(new Date).getTime();t.addEventListener("mouseleave",(function o(){var i=(new Date).getTime()-n,a=r.eventValue.hoverTimeThreshold;i>(void 0===a?1500:a)&&(Object.assign(r.eventValue,{hoverTime:i}),e(r)),t.removeEventListener("mouseleave",o)}))}},default:function(e){return function(t,r){return e(r)}}},jr=function(e){try{return JSON.parse(e.dataset.trackValue||"{}")}catch(e){return{}}},Lr=function(e,t){return function(n){return function(o){var i;!function(e,t){return(Ur[e]||Ur.default)(t[e].bind(t))}(n,e)(o.target,r(r({},t(this,o)),{eventAction:n,pageSection:this.dataset.trackSection,eventLabel:this.dataset.trackLabel,name:(i=o.target,i.name||i.textContent),eventValue:jr(this)}))}}},Vr={scope:E.document,initialData:function(){return{}}},Qr=function(){function e(e){void 0===e&&(e={}),this.options=e,this.options=Xt(e,Vr)}return e.prototype.listen=function(e){var t=this;return new Promise((function(r){var n=lr(Lr(e,t.options.initialData)),o=n.direct,i=n.delegated;pr(t.options.scope),function(e,t){e.forEach(kr(t))}(i,t.options.scope),Rr(o,t.options.scope),function(e,t){e.forEach(Nr(t))}(a(i,o),t.options.scope),r()}))},e.prototype.getOptions=function(){return this.options},e}();E.requestIdleCallback=E.requestIdleCallback||function(e){return setTimeout((function(){var t=Date.now();e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),100)};var qr=1e3;var xr,Mr,Wr=function(){function e(){this.logger=m.getLogger(),this.taskHandle=0,this.started=!1,this.messageQueue=[]}return e.prototype.startProcessing=function(){this.logger.info("starting the message queue"),this.started=!0,this.messageQueue.length>0&&!this.taskHandle&&(this.taskHandle=E.requestIdleCallback(this.processQueue.bind(this),{timeout:qr}))},e.prototype.stopProcessng=function(){this.started=!1},e.prototype.enqueue=function(e,t,r){this.messageQueue.push({handler:e,name:t,payload:r}),this.started&&!this.taskHandle&&(this.taskHandle=E.requestIdleCallback(this.processQueue.bind(this),{timeout:qr}))},e.prototype.processQueue=function(e){!function(e,t){for(;(e.timeRemaining()>0||e.didTimeout)&&t.messageQueue.length&&t.started;){var r=t.messageQueue.shift();r.handler.handleEvent(r.name,r.payload)}}(e,this),this.messageQueue.length&&this.started?this.taskHandle=E.requestIdleCallback(this.processQueue.bind(this),{timeout:qr}):this.taskHandle=0},e}(),Hr=function(e,t,r){return void 0===r&&(r={}),new Promise((function(n,o){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===this.readyState&&(200===this.status?n(this.responseText):o(new Error("Coudln't post "+e)))},i.open("POST",e,!0),r.basicAuth&&(i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("Authorization","Bearer "+r.basicAuth)),i.withCredentials=!0,i.send(t)}))},Fr=function(e){function r(){var t=e.call(this,"")||this;return t.gaId=null,t}return t(r,e),r.prototype.updateGaId=function(){var e=this.getCookie("_ga");this.gaId=e?e.split(".").slice(2).join("."):null},r.prototype.shouldUpdate=function(){return!this.gaId},Object.defineProperty(r.prototype,"clientId",{get:function(){return this.shouldUpdate()&&this.updateGaId(),this.gaId},enumerable:!1,configurable:!0}),r}(_);!function(e){e.ACCOUNT_CREATED="accountCreationSuccess",e.ACCOUNT_CREATED_IFRAME="accountCreationSuccess-iframe",e.CART_VIEWED="Cart Viewed",e.CHECKOUT_START="checkoutStart",e.CHECKOUT_STARTED="Checkout Started",e.COMPONENT_VIEWED="Component Viewed",e.DOWNLOAD="download-success",e.ERROR="Error",e.EXPERIMENT_VIEWED="Experiment Viewed",e.IDENTIFY="Identify",e.INVITE_SENT="Invite Sent",e.ORDER_COMPLETED="Order Completed",e.PAGE="Page",e.PAYMENT_INFO_ENTERED="Payment Info Entered",e.PRODUCT_ADDED="Product Added",e.PRODUCT_ADDED_TO_WISH_LIST="Product Added To Wishlist",e.PRODUCT_CLICKED="Product Clicked",e.PRODUCT_DOWNLOADED="Product Downloaded",e.PRODUCT_LICENSED="Product Licensed",e.PRODUCT_LIST_FILTERED="Product List Filtered",e.PRODUCT_LIST_VIEWED="Product List Viewed",e.PRODUCT_REMOVED="Product Removed",e.PRODUCT_REMOVED_FROM_WISH_LIST="Product Removed from Wishlist",e.PRODUCT_SHARED="Product Shared",e.PRODUCT_VIEWED="Product Viewed",e.PRODUCT_SEARCHED="Products Searched",e.PROMOTION_VIEWED="Promotion Viewed",e.PROMOTION_CLICKED="Promotion Clicked",e.PURCHASE_SUCCESS="purchaseSuccess",e.SEARCHED="searchResults",e.SIGNED_IN="Signed In",e.SIGNED_OUT="Signed Out",e.SIGNED_UP="Signed Up",e.TRACK="Track",e.ACCOUNT_VERIFIED="Account Verified",e.ACCOUNT_SWITCHED="Account Switched",e.DESIGN_RENDERED="Design Rendered",e.DESIGN_SHARED="Design Shared",e.TEMPLATE_LOADED="Template Loaded",e.IMAGE_UPLOADED="Image Uploaded",e.ASSET_VIEWED="Asset Viewed",e.BATCH_EVENTS="Batch of Event",e.CALENDAR_SUBSCRIBED="Calendar Subscribed",e.CALENDAR_UNSUBSCRIBED="Calendar Unsubscribed",e.CALENDAR_TOGGLED_ON="Calendar Toggled On",e.CALENDAR_TOGGLED_OFF="Calendar Toggled Off",e.CALENDAR_TOPIC_SCHEDULED="Calendar Topic Scheduled",e.PRODUCT_UPLOADED="Product Uploaded"}(xr||(xr={}));var Gr=((Mr={})[xr.ASSET_VIEWED]=2e3,Mr.default=1e3,Mr),Br=function(){function e(e){this.eventsQueue={},this.delays=Gr,this.delays=r(r({},this.delays),e)}return e.prototype.add=function(e,t){var r=this;if(this.eventsQueue[e])this.eventsQueue[e].callback=t;else{var n=this.delays[e]||this.delays.default;this.eventsQueue[e]={timeout:setTimeout((function(){return r.send(e)}),n),callback:t}}},e.prototype.send=function(e){var t=(this.eventsQueue[e]||{}).callback;t&&t(),this.clear(e)},e.prototype.clear=function(e){var t=(this.eventsQueue[e]||{}).timeout;t&&clearTimeout(t),delete this.eventsQueue[e]},e}(),zr=function(){function e(e){var t=e.segmentId;this.basicAuth=btoa(t+":"),this.logger=m.getLogger()}return e.prototype.send=function(e,t,r){var n,o,i;if(void 0===t&&(t={}),void 0===r&&(r={}),!e||0===e.length)return Promise.resolve();this.logger.debug("Sending batch events with "+e.length+" items");var a={batch:e,context:t,integrations:r},s=E.JSON.stringify(a);if(this.isOverLimit(s)){this.logger.debug("Batch is over limit of 400kb, spliting batch");var u=Math.ceil(e.length/2),c=e.slice(0,u),d=e.slice(u),l=[];return l.push(this.send(c,t,r)),l.push(this.send(d,t,r)),Promise.all(l)}var h=(null===(i=null===(o=null===(n=E.analytics)||void 0===n?void 0:n.options)||void 0===o?void 0:o.metrics)||void 0===i?void 0:i.host)||"api.segment.io/v1";return Hr("https://"+h+"/batch",s,{basicAuth:this.basicAuth})},e.prototype.isOverLimit=function(e){var t=function(e){var t;try{t=(encodeURI(e).split(/%..|./).length-1)/1024}catch(r){t=e.length/1024}return t}(e);return this.logger.debug("Size of batch is "+t),t>400},e}(),Kr="cdn.segment.com",Jr="4.13.2",$r=function(){function e(e){var t=this;this.load=function(e){return o(t,void 0,void 0,(function(){var t,r;return i(this,(function(n){switch(n.label){case 0:return t=e.segmentId,this.batch=new zr({segmentId:t}),this.config=e,e.consentCategories&&!Array.isArray(e.consentCategories)?[2,Promise.reject(new Error("Categories should be an array"))]:(r=e,[4,this.mapSegmentOptions(e)]);case 1:return r.segmentOptions=n.sent(),[4,this.loadSegment(e)];case 2:return[2,n.sent()]}}))}))},this.mapSegmentOptions=function(e){var r=e.segmentId,n=e.consentCategories,o=e.proxyDomain,i=t;return new Promise((function(e,t){if(!n||n.length<1)return e({});i.logger.debug("Loading segment integrations"),function(e,t){return void 0===t&&(t={json:!0}),new Promise((function(r,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var o=t.json?JSON.parse(this.responseText):this.responseText;r(o)}else n(new Error("Coudln't fetch "+e))},o.open("GET",e,!0),o.send()}))}("https://"+(o||Kr)+"/v1/projects/"+r+"/integrations").then((function(t){for(var r={},o=n.join(";").toLowerCase().split(";"),a=0,s=t;a<s.length;a++){var u=s[a];r[u.name]=o.indexOf(u.category.toLowerCase())>=0}return i.logger.debug("Segment integrations: "+r),e({integrations:r})})).catch(t)}))},this.loadSegment=function(e){var r=e.segmentId,n=e.anonymousId,a=e.segmentOptions,s=void 0===a?{}:a,u=e.proxyDomain,c=t;return new Promise((function(e,t){var a=E.analytics=E.analytics||[];if(a.initialize)t(new Error("Segment already initialized"));else if(a.invoked){var d=new Error("Segment snippet included twice.");c.logger.error(d.message),t(d)}else{var l="https://"+(u||Kr)+"/analytics.js/v1/"+r+"/analytics.min.js";a.invoked=!0,a.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],a.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(e),a.push(t),a}};for(var h=0;h<a.methods.length;h++){var f=a.methods[h];a[f]=a.factory(f)}a.load=function(){var r=this,u=document.createElement("script");u.type="text/javascript",u.async=!0,u.src=l,u.onload=function(){return o(r,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return c.logger.debug("segment has been loaded"),c.providerLoaded=!0,n?[4,c.setAnonymousId(n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e(),[2]}}))}))},u.onerror=function(){t(new Error("Unable to load analytics js."))};var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(u,d),a._loadOptions=s},a._writeKey=r,a.SNIPPET_VERSION=Jr,a.load()}}))},this.setupTagCollector=function(e){if(t.tagCollectorLoaded)t.logger.warn("tag collector integration has already been setup.");else if(t.tagCollectorUrl=e,t.providerLoaded){var r=function(e,t){return e.timestamp||(e.timestamp=new Date),e.type||(e.type=t),e};E.analytics.on("page",(function(e,n,o,i){var a=E.analytics.normalize({properties:o,category:e,options:i,name:n});r(a,"page"),Hr(t.tagCollectorUrl,E.JSON.stringify(a)).catch((function(e){return t.logger.error(e)}))})),E.analytics.on("track",(function(e,n,o){var i=E.analytics.normalize({event:e,properties:n,options:o});r(i,"track"),Hr(t.tagCollectorUrl,E.JSON.stringify(i)).catch((function(e){return t.logger.error(e)}))})),E.analytics.on("identify",(function(e,n,o){var i=E.analytics.normalize({id:e,traits:n,options:o});r(i,"identify"),Hr(t.tagCollectorUrl,E.JSON.stringify(i)).catch((function(e){return t.logger.error(e)}))})),t.tagCollectorLoaded=!0}else t.tagCollectorUrl=e},this.handleEvent=function(e,r){var n=(r||{}).data,o=t.gaId.clientId,i={};switch(o&&(i.integrations={"Google Analytics":{clientId:o}}),e){case xr.PAGE:t.trackEventPage(n,i);break;case xr.IDENTIFY:t.trackEventIdentify(n,i);break;case xr.ACCOUNT_CREATED:t.trackEventAccountCreated(n,i);break;case xr.SIGNED_UP:t.trackEventSignedUp(n,i);break;case xr.SIGNED_OUT:t.trackEventSignedOut(n,i);break;case xr.SIGNED_IN:t.trackEventSignedIn(n,i);break;case xr.TRACK:t.trackNonKpiStandard(r,i);break;case xr.ASSET_VIEWED:t.trackAssetViewed(n,i);break;case xr.BATCH_EVENTS:t.trackBatchEvent(r,i);break;default:t.trackDefaultEvent(n,e,i)}},this.trackEventPage=function(e,r){try{var n=e.page.pageType;t.logger.info("EVENT pageview: "+n),E.analytics.page(n,e,r),t.eventDebounce.send(xr.ASSET_VIEWED)}catch(e){t.logger.error("EVENT ERROR pageview")}},this.trackEventIdentify=function(e,n){void 0===n&&(n={});try{var o=e.userId,i=e.traits,a=e.opt,s=e.anonymousId,u=r({},n),c=t.composeExternalIds(a);c&&(u.externalIds=c),t.logger.info("EVENT identify"),E.analytics.identify(o,i,u),s&&E.analytics.user&&E.analytics.user().anonymousId(s)}catch(e){t.logger.error("EVENT ERROR identify")}},this.trackEventAccountCreated=function(e,r){try{t.logger.info("EVENT track: account created"),E.analytics.track(xr.ACCOUNT_CREATED,e,r),E.analytics.track(xr.ACCOUNT_CREATED_IFRAME,e,r)}catch(e){t.logger.error("EVENT ERROR track: account created")}},this.trackEventSignedUp=function(e,r){void 0===r&&(r={});try{t.logger.info("EVENT track: Signed up");e.opt;var o=n(e,["opt"]);E.analytics.track(xr.SIGNED_UP,o,r),E.analytics.track(xr.ACCOUNT_CREATED_IFRAME,o,r)}catch(e){t.logger.error("EVENT ERROR track: Signed up")}},this.trackEventSignedOut=function(e,r){try{t.logger.info("EVENT track: Signed out"),E.analytics.reset(),e.segmentAnonymousId&&E.analytics.user().anonymousId(e.segmentAnonymousId),E.analytics.track(xr.SIGNED_OUT,e,r)}catch(e){t.logger.error("EVENT ERROR track: Signed out")}},this.trackEventSignedIn=function(e,r){void 0===r&&(r={});try{t.logger.info("EVENT track: Signed In");e.opt;var o=n(e,["opt"]);E.analytics.track(xr.SIGNED_IN,o,r)}catch(e){t.logger.error("EVENT ERROR track: Signed out")}},this.trackDefaultEvent=function(e,r,n){try{t.logger.info("EVENT track: "+r),E.analytics.track(r,e,n)}catch(e){t.logger.error("EVENT ERROR track: "+r)}},this.trackNonKpiStandard=function(e,r){var n=e.name;t.trackDefaultEvent(e.data,n,r)},this.trackAssetViewed=function(e,r){t.eventDebounce.add(xr.ASSET_VIEWED,(function(){try{t.logger.info("EVENT track: Asset Viewed"),E.analytics.track(xr.ASSET_VIEWED,e,r)}catch(e){t.logger.error("EVENT ERROR track: Asset viewed")}}))},this.trackBatchEvent=function(e,n){try{var o=e.event,i=e.list,a=n.integrations,s=E.analytics,u=(s.normalize({})||{context:{}}).context,c={name:"analytics.js",version:s.VERSION||Jr},d=E.navigator,l=d.language,h=d.userAgent,f=r(r({},u),{library:c,locale:l,userAgent:h}),p=[];E.dataLayer=E.dataLayer||[];var v=E.dataLayer;i.forEach((function(e){var t=e.userId||s.user().id(),n=e.anonymousId||s.user().anonymousId();p.push({type:"track",event:o,properties:e,userId:t,anonymousId:n}),v.push(r({event:o,userId:t,segmentAnonymousId:n},e))})),t.batch.send(p,f,a)}catch(e){t.logger.error("EVENT ERROR track: Batch: "+JSON.stringify(e))}},this.composeExternalIds=function(e){if(!e)return null;var t=[];return Object.keys(e).forEach((function(r){Jt.indexOf(r)>=0&&t.push({id:e[r],type:r,collection:"users",encoding:"none"})})),t&&t.length>0?t:null},this.providerLoaded=!1,this.tagCollectorLoaded=!1,this.tagCollectorUrl=null,this.logger=m.getLogger(),this.eventDebounce=new Br(null==e?void 0:e.eventDelays),this.gaId=new Fr}return e.prototype.setAnonymousId=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:t=0,r.label=1;case 1:return void 0!==E.analytics.user?[3,3]:[4,(n=500,new Promise((function(e){setTimeout((function(){return e()}),n)})))];case 2:return r.sent(),(t+=1)>=6?[3,3]:[3,1];case 3:return void 0===E.analytics.user?(this.logger.debug("Unable to set anonymousId"),[2,!1]):(this.logger.debug("Ticks: "+t),E.analytics.user().anonymousId(e),[2,!0])}var n}))}))},e}(),Yr=function(e){function r(){var t=e.call(this,"sstk_session_id")||this;return t.extendSessionIdExpiration=function(){var e=Date.now()-t.startTime,n=t.sessionId||t.getCookie(t.cookie.name);return!n||e>r.Expiration?(t.logger.debug("creating new session Id"),n=t.getUniqueCookieValue(),t.setCookie(t.cookie.name,n,r.Expiration)):(n&&!t.sessionId||e>r.Extension)&&(t.startTime=Date.now(),t.logger.debug("extending session Id"),t.updateCookieExpiration(r.Expiration)),n.replace(/["]+/g,"")},t.startTime=Date.now(),t.sessionId=t.extendSessionIdExpiration(),t}return t(r,e),r.Expiration=18e5,r.Extension=9e5,r}(_);return function(){function e(e){var t=this;this.getAnonID=function(){return(t.anonId||{}).anonId},this.getSessionId=function(){return(t.sessionId||{}).sessionId},this.options=e||{},this.debugMode=this.options.debugMode||!1,this.initialDataSet=!1,this.data=new ar({}),this.logger=m.getLogger(this.debugMode),this.listener=null,this.errorMonitor=!1,this.anonId=void 0===E?null:new b,this.messageQueue=new Wr,this.provider=new $r({eventDelays:null==e?void 0:e.eventDelays}),this.sessionId=void 0===E?null:new Yr,void 0!==E&&(E.sstkAW=this)}return e.prototype.loadProvider=function(e,t){var r=this;return new Promise((function(n,o){var i=e||r.options.sourceId,a=t||r.options.consentCategories;if(!i){var s="unable to load AnalyticsWrapper due to missing source id";return r.logger.error(s,!0),o(new Error(s))}return r.provider.load({segmentId:i,anonymousId:r.anonId.anonId,consentCategories:a,proxyDomain:r.options.proxyDomain}).then((function(){if(r.options.tagCollectorUrl&&r.provider.setupTagCollector(r.options.tagCollectorUrl),r.initialDataSet)r.messageQueue.startProcessing();else{var e=nr(window.location.href);Object.keys(e).length&&(r.setData(e),r.provider.providerLoaded&&!r.messageQueue.started&&r.messageQueue.startProcessing())}n(r)})).catch((function(e){r.logger.error("error starting wrapper: "+e,!0),o(e)}))}))},e.prototype.setInitialData=function(e){var t,r=nr((null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.originalUrl)||"");r&&this.setData(r),this.data.update(e||{}),this.initialDataSet||(this.messageQueue.messageQueue.forEach((function(t){t.payload.data=Zt(t.payload.data,e)})),this.provider.providerLoaded&&!this.messageQueue.started&&this.messageQueue.startProcessing()),this.initialDataSet=!0},e.prototype.setData=function(e){this.data.update(e||{})},e.prototype.startListener=function(e){return this.listener?(this.logger.warn("listener has already been started"),this):(this.listener=new Qr(e),this.listener.listen(this),this)},e.prototype.enableErrorMonitor=function(e){var t=this;return void 0===e&&(e={}),this.errorMonitor?(this.logger.warn("Error monitor has already been started"),this):((e=Xt(e,{scope:E})).scope.addEventListener("error",(function(e){var r;if(e){e.error&&e.error.stack&&(r=e.error.stack.substring(0,150));var n={message:e.message,file:e.filename,lineNumber:e.lineno,columnNumber:e.colno,stackTrace:r,sourceType:"javascript"};t.error(n)}})),this.errorMonitor=!0,this)},e.prototype.setTagCollectorUrl=function(e){return!this.provider.tagCollectorLoaded&&this.provider.providerLoaded?this.provider.setupTagCollector(e):this.provider.tagCollectorUrl=e,this},e.prototype.page=function(e,t){var r=t;r||(r="object"==typeof e?e:{});var n=this.sessionId.extendSessionIdExpiration(),o=this.data.update({page:r,sstk_session_id:n});return(!this.initialDataSet||this.options.deferLoadProvider&&!this.provider.providerLoaded)&&(o=Xt(o,function(){var e=E.location.href,t=e.indexOf("#"),r=-1===t?e:e.slice(0,t);return{path:E.location.pathname,referrer:E.document.referrer,search:E.location.search,title:E.document.title,url:r}}())),this.messageQueue.enqueue(this.provider,xr.PAGE,{data:o}),this},e.prototype.identify=function(e,t,r){var n=this.data.toJSON().user;if(n){var o=n.isImpersonated,i=n.id;if("string"==typeof o&&(o="true"===o),o||!i||""===i)return this}var a={userId:e,traits:t||{},opt:r||{},anonymousId:""},s=this.getAnonID();s&&(a.anonymousId=s),"object"==typeof e&&null!=e&&(a.traits=e,a.userId=e.id),a.traits.is_merged_identity=!1,a.userId||n&&n.id&&(a.userId=n.id);var u=this.data.toJSON().visit;return u&&u.visitorId&&(a.opt.visitor_id=u.visitorId),this.messageQueue.enqueue(this.provider,xr.IDENTIFY,{data:a}),this},e.prototype.accountCreated=function(e){var t=this.data.update({user:e});return this.messageQueue.enqueue(this.provider,xr.ACCOUNT_CREATED,{data:t}),this},e.prototype.downloaded=function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var r=this.data.overlay({eventValue:e,searchContext:t});return this.messageQueue.enqueue(this.provider,xr.DOWNLOAD,{data:r}),this},e.prototype.experiment=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.EXPERIMENT_VIEWED,{data:t}),this},e.prototype.searched=function(e){void 0===e&&(e={});var t=this.data.overlay({searchContext:e});return this.messageQueue.enqueue(this.provider,xr.SEARCHED,{data:t}),this},e.prototype.checkoutStarted=function(e){if(void 0===e&&(e={}),e.currencyCode){var t=this.data.overlay({ecommerce:e});return this.messageQueue.enqueue(this.provider,xr.CHECKOUT_START,{data:t}),this}var r=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.CHECKOUT_STARTED,{data:r}),this},e.prototype.orderCompleted=function(e){if(void 0===e&&(e={}),e.currencyCode){var t=this.data.overlay({ecommerce:e});return this.messageQueue.enqueue(this.provider,xr.PURCHASE_SUCCESS,{data:t}),this}var r=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.ORDER_COMPLETED,{data:r}),this},e.prototype.customEvent=function(e,t){void 0===t&&(t={});var r=this.data.overlay(t);return this.messageQueue.enqueue(this.provider,xr.TRACK,{name:e,data:r}),this},e.prototype.gaEvent=function(e,t){void 0===t&&(t={}),this.logger.warn("gaEvent should not be used, please use customEvent method instead");var r=this.data.overlay(t,{name:e});return r.eventCategory=t.eventAction,r.eventAction=t.eventLabel,delete r.eventLabel,this.messageQueue.enqueue(this.provider,xr.TRACK,{name:"gaEvent",data:r}),this},e.prototype.error=function(e){void 0===e&&(e={});var t=this.data.overlay({error:or(e)});return this.messageQueue.enqueue(this.provider,xr.ERROR,{name:"Error",data:t}),this},e.prototype.click=function(e,t){var r=rr(this.data,e,t,{eventAction:"click"}),n=r[0],o=r[1];return this.messageQueue.enqueue(this.provider,xr.TRACK,{name:n,data:o}),this},e.prototype.change=function(e,t){var r=rr(this.data,e,t,{eventAction:"change"}),n=r[0],o=r[1];return this.messageQueue.enqueue(this.provider,xr.TRACK,{name:n,data:o}),this},e.prototype.hover=function(e,t){var r=rr(this.data,e,t,{eventAction:"hover"}),n=r[0],o=r[1];return this.messageQueue.enqueue(this.provider,xr.TRACK,{name:n,data:o}),this},e.prototype.submit=function(e,t){var r=rr(this.data,e,t,{eventAction:"submit"}),n=r[0],o=r[1];return this.messageQueue.enqueue(this.provider,xr.TRACK,{name:n,data:o}),this},e.prototype.productListViewed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_LIST_VIEWED,{data:t}),this},e.prototype.signedIn=function(e){void 0===e&&(e={});var t=this.data.overlay(e);this.messageQueue.enqueue(this.provider,xr.SIGNED_IN,{data:t});var r=t.user.id;return r&&this.identify(r),this},e.prototype.inviteSent=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.INVITE_SENT,{data:t}),this},e.prototype.productSearched=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_SEARCHED,{data:t}),this},e.prototype.productAddedToWishlist=function(e){if(void 0===e&&(e={}),Array.isArray(e.products||e))return this.sendBatch(xr.PRODUCT_ADDED_TO_WISH_LIST,e);var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_ADDED_TO_WISH_LIST,{data:t}),this},e.prototype.signedUp=function(e){void 0===e&&(e={});var t=this.data.overlay(e);this.messageQueue.enqueue(this.provider,xr.SIGNED_UP,{data:t});var r=t.user.id;return r&&this.identify(r),this},e.prototype.cartViewed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.CART_VIEWED,{data:t}),this},e.prototype.paymentInfoEntered=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PAYMENT_INFO_ENTERED,{data:t}),this},e.prototype.productAdded=function(e){if(void 0===e&&(e={}),Array.isArray(e.products||e))return this.sendBatch(xr.PRODUCT_ADDED,e);var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_ADDED,{data:t}),this},e.prototype.productRemoved=function(e){if(void 0===e&&(e={}),Array.isArray(e.products||e))return this.sendBatch(xr.PRODUCT_REMOVED,e);var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_REMOVED,{data:t}),this},e.prototype.componentViewed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.COMPONENT_VIEWED,{data:t}),this},e.prototype.signedOut=function(e){void 0===e&&(e={});var t=this.data.overlay(e),r=this.getAnonID();return r&&(t.segmentAnonymousId=r),this.messageQueue.enqueue(this.provider,xr.SIGNED_OUT,{data:t}),this},e.prototype.promotionViewed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PROMOTION_VIEWED,{data:t}),this},e.prototype.promotionClicked=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PROMOTION_CLICKED,{data:t}),this},e.prototype.productListFiltered=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_LIST_FILTERED,{data:t}),this},e.prototype.productClicked=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_CLICKED,{data:t}),this},e.prototype.productViewed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_VIEWED,{data:t}),this},e.prototype.productRemovedFromWishlist=function(e){if(void 0===e&&(e={}),Array.isArray(e.products||e))return this.sendBatch(xr.PRODUCT_REMOVED_FROM_WISH_LIST,e);var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_REMOVED_FROM_WISH_LIST,{data:t}),this},e.prototype.productShared=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_SHARED,{data:t}),this},e.prototype.productDownloaded=function(e){if(void 0===e&&(e={}),Array.isArray(e.products||e))return this.sendBatch(xr.PRODUCT_DOWNLOADED,e);var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_DOWNLOADED,{data:t}),this},e.prototype.productLicensed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_LICENSED,{data:t}),this},e.prototype.accountVerified=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.ACCOUNT_VERIFIED,{data:t}),this},e.prototype.accountSwitched=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.ACCOUNT_SWITCHED,{data:t}),this},e.prototype.designRendered=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.DESIGN_RENDERED,{data:t}),this},e.prototype.designShared=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.DESIGN_SHARED,{data:t}),this},e.prototype.imageUploaded=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.IMAGE_UPLOADED,{data:t}),this},e.prototype.templateLoaded=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.TEMPLATE_LOADED,{data:t}),this},e.prototype.assetViewed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.ASSET_VIEWED,{data:t}),this},e.prototype.calendarSubscribed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.CALENDAR_SUBSCRIBED,{data:t}),this},e.prototype.calendarUnsubscribed=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.CALENDAR_UNSUBSCRIBED,{data:t}),this},e.prototype.calendarToggledOn=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.CALENDAR_TOGGLED_ON,{data:t}),this},e.prototype.calendarToggledOff=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.CALENDAR_TOGGLED_OFF,{data:t}),this},e.prototype.calendarTopicScheduled=function(e){void 0===e&&(e={});var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.CALENDAR_TOPIC_SCHEDULED,{data:t}),this},e.prototype.productUploaded=function(e){if(void 0===e&&(e={}),Array.isArray(e.products||e))return this.sendBatch(xr.PRODUCT_UPLOADED,e);var t=this.data.overlay(e);return this.messageQueue.enqueue(this.provider,xr.PRODUCT_UPLOADED,{data:t}),this},e.prototype.sendBatch=function(e,t){var o=this;void 0===t&&(t={});var i=t.batch_id||p(),a=t.products,s=n(t,["products"]);Array.isArray(t)&&(a=t,s=null);var u=a.map((function(e){return o.data.overlay(r(r(r({},s),e),{batch_id:i}))}),[]);return this.messageQueue.enqueue(this.provider,xr.BATCH_EVENTS,{event:e,list:u}),this},e}()}));
//# sourceMappingURL=index.js.map
